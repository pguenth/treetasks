% Treetasks cheatsheet
% 
% Based on:
%    "Builtin normal mode keys of Vifm" cheatsheet
%   
%    Copyright (C) 2020 xaizek.
%    Made available under the terms of Apache 2.0 license.
%   
%    Note that LaTeX knowledge of the author is extermely limited and the code
%    below is probably of quite low quality.
% 
% Modified by Patrick GÃ¼nther
%

\documentclass[landscape]{article}

\usepackage[latin1]{inputenc}
\usepackage{tikz}

\usepackage{color}
\usepackage{colortbl}
\usepackage{fontawesome}
\usepackage{setspace}

\usepackage[paperwidth=32.5cm, paperheight=28cm] {geometry}
\geometry{top=2mm,bottom=0mm,left=-3mm,right=0mm}

\usepackage[oldsyntax]{stackengine}
\newcommand\makeblock[3]{\parbox[t]{#1}{\textbf{#2}\\[2pt]#3}}
\Sstackgap=1.5ex

\setlength{\tabcolsep}{0.2em}

% disable page numbers
\pagestyle{empty}

\newlength\unit
\newlength\sep
\newlength\base

\setlength{\unit}{0.3cm}
\setlength{\sep}{0.4\unit} %
\setlength{\base}{4\unit}

% comment this line for big keyboard (and increase page size)
\def\shortkeyboard{\true}

\definecolor{util}{gray}{0.5}
\definecolor{note}{RGB}{75,75,205}
\definecolor{keyname}{RGB}{225,75,75}

\newcommand{\s}[1]{{\color{util}#1}}

\newcommand{\note}[1]{{\color{note}(#1)}}

\newcommand{\shortcut}[1]{\texttt{#1}}

\newcommand{\keyname}[1]{{\color{keyname}\textbf{\footnotesize#1}}}
\newcommand{\keydesc}[1]{
    \begin{spacing}{0.75}
        \sffamily\scriptsize#1
    \end{spacing}
}

\def\fkeyd#1#2#3 {
    \draw ++(\X,\Y)       rectangle +(\base,\base)
           +(0,0.85\base) node[text width=10cm,text height=1,anchor=north west] {\keyname{#1}\vspace{3px}\keydesc{#2}};
    \setlength{\X}{\X + \base + #3\sep}
}
\def\unusedfkey#1#2 { % the second argument is just to allow spaces before the first one
    \fill[very nearly transparent,gray]
         ++(\X,\Y) rectangle +(\base,\base);
    \draw[nearly transparent,gray]
         +(\X,\Y+0.85*\base) node[text width=10cm,text height=1,anchor=north west] {\keyname{#1}};
    \setlength{\X}{\X + \base + #2\sep}
}

\def\longfkeyd(#1)#2#3 {
    \draw ++(\X,\Y)       rectangle +(#1,1\base)
           +(0,0.65\base) node[text width=10cm,text height=1,text ragged,anchor=north west] {\keyname{#2}\vspace{3px}\keydesc{#3}};
    \setlength{\X}{\X + #1 + \sep}
}
\def\unusedlongfkey(#1)#2#3 { % the third argument is just to allow spaces before the second one
    \fill[very nearly transparent,gray]
         ++(\X,\Y) rectangle +(#1,\base);
    \draw[nearly transparent,gray]
         +(\X+0.1\base,\Y+0.5\base) node[text width=2,text height=1] {\keyname{#2}};
    \setlength{\X}{\X + #1 + \sep}
}

\def\keyd#1#2,#3#4 {
    \draw ++(\X,\Y) rectangle +(\base,\base)
           +(0.47\base,0.8\base) node[text width=1cm,text height=1,anchor=north east,align=center] {\keyname{#1}}
           +(0.47\base,0.3\base) node[text width=1cm,text height=1,anchor=north east,align=center] {\keyname{#3}}
           +(0.23\base,0.72\base) node[text width=1.4cm,text height=1,text ragged,anchor=west,align=left] {\keydesc{#2}}
           +(0.23\base,0.22\base) node[text width=1.4cm,text height=1,text ragged,anchor=west,align=left] {\keydesc{#4}};

    \draw [densely dotted] ++(\X,\Y+0.5\base) -- +(\base,0);
    \setlength{\X}{\X + \base + \sep}
}
\def\keydd#1#2,#3#4,#5#6 {
    \draw ++(\X,\Y) rectangle +(\base,\base)
           +(0.47\base,0.88\base)   node[text width=1cm,text height=1,anchor=north east,align=center] {\keyname{#1}}
           +(0.47\base,0.53\base)       node[text width=1cm,text height=1,anchor=north east,align=center] {\keyname{#3}}
           +(0.47\base,0.2\base)       node[text width=1cm,text height=1,anchor=north east,align=center] {\keyname{#5}}
           +(0.23\base,0.8\base) node[text width=1.4cm,text height=1,text ragged,anchor=west] {\keydesc{#2}}
           +(0.23\base,0.47\base)         node[text width=1.4cm,text height=1,text ragged,anchor=west] {\keydesc{#4}}
           +(0.23\base,0.13\base)         node[text width=1.4cm,text height=1,text ragged,anchor=west] {\keydesc{#6}};

    \draw [densely dotted] ++(\X,\Y+0.67\base) -- +(\base,0);
    \draw [densely dotted] ++(\X,\Y+0.33\base) -- +(\base,0);
    \setlength{\X}{\X + \base + \sep}
}

\def\unusedkeyd#1#2,#3#4 {
    \fill[very nearly transparent,gray]
         ++(\X,\Y) rectangle +(\base,\base);
    \draw[nearly transparent,gray]
           +(\X+0.47\base,\Y+0.8\base) node[text width=1cm,text height=1,anchor=north east,align=center] {\keyname{#1}}
           +(\X+0.47\base,\Y+0.3\base) node[text width=1cm,text height=1,anchor=north east,align=center] {\keyname{#3}}
           +(\X+0.23\base,\Y+0.72\base) node[text width=1.4cm,text height=1,text ragged,anchor=west,align=left] {\keydesc{#2}}
           +(\X+0.23\base,\Y+0.22\base) node[text width=1.4cm,text height=1,text ragged,anchor=west,align=left] {\keydesc{#4}};

    \draw[nearly transparent,densely dotted]
         ++(\X,\Y+0.5\base) -- +(\base,0);
    \setlength{\X}{\X + \base + \sep}
}

\def\unusedkeydHalf#1#2,#3#4 {
    \fill[very nearly transparent,gray]
         ++(\X,\Y) rectangle +(\base,\base);
    \draw[nearly transparent,gray]
           +(\X+0.47\base,\Y+0.8\base) node[text width=1cm,text height=1,anchor=north east,align=center] {\keyname{#1}}
           +(\X+0.23\base,\Y+0.72\base) node[text width=1.4cm,text height=1,text ragged,anchor=west,align=left] {\keydesc{#2}};
    \draw
           +(\X+0.47\base,\Y+0.3\base) node[text width=1cm,text height=1,anchor=north east,align=center] {\keyname{#3}}
           +(\X+0.23\base,\Y+0.22\base) node[text width=1.4cm,text height=1,text ragged,anchor=west,align=left] {\keydesc{#4}};

    \draw[densely dotted]
         ++(\X,\Y+0.5\base) -- +(\base,0);
    \setlength{\X}{\X + \base + \sep}
}

\def\unusedkey#1,#2 {
    \fill[very nearly transparent,gray]
         ++(\X,\Y) rectangle +(\base,\base);
    \draw[nearly transparent,gray]
         (\X+0.1\base,\Y+0.6\base) node[text width=1,text height=1,anchor=south] {\keyname{#1}}
         +(0.0,-0.5\base)          node[text width=1,text height=1,anchor=south] {\keyname{#2}};

    \draw[nearly transparent,densely dotted]
         ++(\X,\Y+0.5\base) -- +(\base,0);
    \setlength{\X}{\X + \base + \sep}
}
\def\unusedlongkey(#1)#2,#3 {
    \fill[very nearly transparent,gray]
         ++(\X,\Y) rectangle +(#1,\base);
    \draw[nearly transparent,gray]
          (\X+0.1\base,\Y+0.5\base) node[text width=2,text height=1,anchor=south] {\keyname{#2}}
         +(0.0,-0.5\base)           node[text width=2,text height=1,anchor=south] {\keyname{#3}};

    \draw[nearly transparent,densely dotted] ++(\X,\Y+0.5\base) -- +(#1,0);
    \setlength{\X}{\X + #1 + \sep}
}

\begin{document}

\begin{tikzpicture}[scale=1.6]
    \tikzstyle{every path}=[draw]

    \pgfsetcornersarced{\pgfpoint{1mm}{1mm}}

    \newlength\X
    \newlength\Y

    \Y=0\unit

    \draw (0\unit,\Y + 0.9\unit)
          node[text width=\textwidth,text height=10,text centered,anchor=west]
          {\LARGE \scshape Treetasks cheatsheet};
    
    \setlength{\Y}{\Y - \base - \unit + \sep}
    % F row
    \newcommand{\frowsep}{6}
    \X=0\unit
    \pgfmathparse{2*\frowsep}
    \fkeyd          {Esc}{confirm editing}{\pgfmathresult}
    \unusedfkey           {F1}
    \unusedfkey      {F2}
    \unusedfkey           {F3}
    \unusedfkey          {F4}{\frowsep}
    \unusedfkey           {F5}
    \unusedfkey           {F6}
    \unusedfkey           {F7}
    \unusedfkey           {F8}{\frowsep}
    \unusedfkey      {F9}
    \unusedfkey           {F10}
    \unusedfkey      {F11}
    \unusedfkey      {F12}
\ifx \shortkeyboard \defined
    \setlength{\X}{\X + 0.5\base - \sep}
    \unusedfkey     {Print\\Screen}
    \unusedfkey          {Scroll\\Lock}
    \unusedfkey          {Pause}
\fi
    
    \setlength{\Y}{\Y - \base - \unit - \sep}
    % numeric row
    \X=0\unit
    \unusedkey           {\texttildelow}{},{`}{}
    \unusedkey           !{},1{}
    \unusedkey           @{},2{}
    \unusedkey           \#{} ,3{}
    \unusedkey           {\$}{},4{}
    \unusedkey     \%{},5{}
    \unusedkey           \^{},6{}
    \unusedkey           \&,7{}
    \unusedkey            *,8{}
    \unusedkey           ({},9{}
    \unusedkey           ){},0{}
    \unusedkey            \_,{\textendash}{}
    \unusedkey           +{},={}
    \longfkeyd (2\base)  {Backspace}{}
\ifx \shortkeyboard \defined
    \setlength{\X}{\X + 0.5\base - \sep}
    \unusedfkey     {Insert}
    \unusedfkey          {Home}{}
    \unusedfkey          {Page\\Up}{}
\fi

    \setlength{\Y}{\Y - \base - \sep}
    % upper row
    \X=0\unit
    \longfkeyd      (2\base - \unit) {Tab}{switch tab\\(currently in dev)}
    \keyd          Q{quit without saving},q{quit}
    \unusedkey          W{},w{}
    \keyd          E{set scheduled tomorrow},e{set scheduled today}
    \keyd          R{set due tomorrow},r{set due today}
    \keyd           T{previous tab},t{open/create new tab}
    \keyd           Y{move down (secondary)},y{copy cursor}
    \keyd          U{move up (secondary)},u{toggle movement}
    \keyd           I{new child (top)},i{edit title}
    \keyd           O{new task above},o{new task below}
    \keyd           P{},p{paste\note{1}}
    \unusedkey           \{{},[{}
    \unusedkey           \}{},]{}
    \unusedlongkey  (\base + \unit) {\textbar},{\textbackslash}
\ifx \shortkeyboard \defined
    \setlength{\X}{\X + 0.5\base - \sep}
    \unusedfkey     {Delete}
    \unusedfkey          {End}{}
    \unusedfkey          {Page\\Down}{}
\fi

    \setlength{\Y}{\Y - \base - \sep}
    % home row
    \X=0\unit
    \longfkeyd (2\base) {Caps Lock}{ }
    \keyd           A{new child (bottom)},a{edit text}
    \keyd           S{save},s{sort\note{2}}
    \keyd          D{delete},d{cut}
    \keyd           F{toggle sort tagged below},f{toggle collapse}
    \keyd          G{toggle show done},g{toggle done}
    \keyd          H{},h{move to parent}
    \keyd           J{move selected task down},j{move down}
    \keyd           K{move selected task up},k{move up}
    \keyd          L{toggle global schedule},l{move to children}
    \unusedkey           :{},;{}
    \unusedkey           "{},'{}
    \longfkeyd      (2\base + \sep) {Enter}{confirm editing}

    \setlength{\Y}{\Y - \base - \sep}
    % lower row
    \X=0\unit
    \longfkeyd      (2\base + 2\sep) {Shift}{}
    \keyd           Z{show all categories},z{show only categories}
    \keydd          {\textasciicircum X}{abort editing},X{unhide categories},x{hide categories}
    \keyd          C{replace title},c{edit properties\note{3}}
    \keyd           V{toggle show cancelled},v{toggle cancelled}
    \keyd          B{},b{}
    \keyd          N{today\\(schedule)},n{down\\(schedule)}
    \keyd           M{top\\(schedule)},m{up\\(schedule)}
    \unusedkey           {\textless},,
    \unusedkey           {\textgreater},.{\textcolor{gray}{}}
    \unusedkey           ?{},/{}
    \longfkeyd      (3\base) {Shift}{}
\ifx \shortkeyboard \defined
    \setlength{\X}{\X + 0.5\base - \sep + \base + \sep}
    \fkeyd          {$\uparrow$}{\shortcut{k}}
\fi

    \setlength{\Y}{\Y - \base - \sep}
    % space row
    \X=0\unit
    \longfkeyd      (1.5\base + \sep) {Ctrl}{}
    \unusedlongfkey (\base)           {\faLinux}
    \unusedlongfkey (\base + \sep)    {Alt}
    \longfkeyd      (7\base)          {Space}{}
    \unusedlongfkey (\base + \sep)    {Alt}
    \unusedlongfkey (\base)           {\faLinux}
    \unusedlongfkey (\base + 2\sep)   {Menu}
    \longfkeyd      (1.5\base + \sep) {Ctrl}{}
\ifx \shortkeyboard \defined
    \setlength{\X}{\X + 0.5\base - \sep}
    \fkeyd          {$\leftarrow$}{\shortcut{h}}
    \fkeyd          {$\downarrow$}{\shortcut{j}}
    \fkeyd          {$\leftarrow$}{\shortcut{l}}
\fi

\end{tikzpicture}

\def\blockA{
    \makeblock{6cm}{Paste \note{1}}{
        Keychains for pasting:
        \begin{itemize}
            \item \shortcut{pp} Paste after cursor
            \item \shortcut{pP} Paste in front of cursor
            \item \shortcut{po} Paste as child, after other children
            \item \shortcut{pO} Paste as child, in front of other children
        \end {itemize}
    }
}
\def\blockB{
    \makeblock{6cm}{Cut/Delete \note{2}}{
        Keychains for cutting/deleting:
        \begin{itemize}
            \item \shortcut{dd} Cut cursor
            \item \shortcut{dD} Delete cursor (to keep clipboard)
        \end {itemize}
   }
}
\def\blockC{
    \makeblock{6cm}{Sort \note{2}}{
        Keychains for reordering the tree.
        The "natural" order defined by moving around tasks is always saved.
        Replace the second letter of the keychain by its corresponding capital to order in reverse.
        \begin{itemize}
            \item \shortcut{ss} Restore natural order
            \item \shortcut{st} Sort by title
            \item \shortcut{sp} Sort by priority
            \item \shortcut{sc} Sort by category
            \item \shortcut{sr} Sort by due date
            \item \shortcut{se} Sort by scheduled date
            \item \shortcut{sd} Sort by whichever date is earlier (like the schedule)
        \end {itemize}
    }
}
\def\blockD{
    \makeblock{6cm}{Edit \note{3}}{
        Keychains for editing tasks.
        \begin{itemize}
            \item \shortcut{cp} Edit priority
            \item \shortcut{cc} Edit category
            \item \shortcut{cr} Edit due date
            \item \shortcut{ce} Edit scheduled date
        \end {itemize}
        Without using keychains, the rest of the properties can be edited:
        \begin{itemize}
            \item \shortcut{i} Edit title
            \item \shortcut{C} Replace title
            \item \shortcut{a} Edit description text
        \end {itemize}

    }
}
\def\blockE{
    \makeblock{6cm}{Movement}{
        You can traverse the tree in two ways:
        \begin{itemize}
            \item \textbf{Flat:} The next/previous tasks are the tasks on the next/previous line, regardless of hierarchy
            \item \textbf{Hierarchically:} Traversing only traverses the siblings, visiting children/parents need explicit operations.
        \end{itemize}
        Treetasks always keeps both ways at your hands: there is a primary and a secondary mode of movement, the primary is mapped on the well-known \shortcut{j} and \shortcut{k} keys per default, and the secondary is mapped on \shortcut{Y} and \shortcut{U} keys per default.
        By pressing \shortcut{u} (default) the primary and secondary modes are swapped.
        The default order can be set by the config variable \texttt{behaviour.primary\_movement\_hierarchic}.
        When \texttt{True} the primary mode is hierarchical movement, when \texttt{False} the primary mode is flat movement.

        For making hierarchical movement more practical there is the option \texttt{behaviour.auto\_move\_up} which when set to \texttt{True} (default) moves the cursor as in flat movement for one step when reaching the end of a set of children.

        When \texttt{behaviour.roundtrip} is set the cursor can go around the ends of the list. If \texttt{behaviour.auto\_move\_up} is not set, children are also traversed in roundtrips.
        
    }
}

\def\blockF{
    \makeblock{6cm}{Schedule}{
        The schedule shows tasks that are not marked as done or cancelled and have a scheduled date or due date assigned. 
        They are sorted by the earlier date of those two.
        Tasks whose scheduled date or due date lies in the past are printed in red, tasks that are scheduled or due today are printed in yellow.

        The schedule has its own independent cursor which is controlled by \shortcut{n} and \shortcut{m} by default. You can directly skip to the top using \shortcut{M} and to today using \shortcut{N}.

        \begin{itemize}
            \item \texttt{behaviour.follow\_schedule}: If set to \texttt{True} cursor movements in the schedule result in the tree cursor jumping to the task selected in the schedule (only if the task is currently shown in the tree). Default: \texttt{True}.
            \item \texttt{behaviour.filter\_categories\_schedule}: If set to \texttt{True}, the schedule is filtered by the same category filters that apply to the tree. Default: \texttt{False}.
            \item \texttt{behaviour.global\_schedule}: If set to \texttt{True}, the schedule is generated from all tasks from all open tabs. If set to \texttt{False}, every tab has its own schedule. If a global schedule is used, a + sign denotes tasks that are not in the currently shown tab. If the cursor follows the schedule cursor, tabs are automatically switched, too. Default: \texttt{True}.

        \end{itemize}

        
    }
}

\vspace{+2ex}
\scriptsize
\Shortunderstack{ {\protect\blockA}  }
\Shortunderstack{ {\protect\blockC}  }
\Shortunderstack{ {\protect\blockD}  }
\Shortunderstack{ {\protect\blockE}  }
\Shortunderstack{ {\protect\blockF}  }

\end{document}
